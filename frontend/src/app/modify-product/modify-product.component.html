<div class="container mt-4">
  <h4 class="mb-3">Term√©k adatainak m√≥dos√≠t√°sa</h4>

  <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
  <!-- N√©v -->
  <div class="mb-3">
    <label for="name" class="form-label">Term√©k neve <span class="text-danger">*</span></label>
    <input
      type="text"
      id="name"
      formControlName="name"
      class="form-control"
      placeholder="Pl.: Horg√°szbot"
      [ngClass]="{'is-invalid': productForm.get('name')?.invalid && productForm.get('name')?.touched}"
    />

    <!-- üîπ Valid√°ci√≥s hib√°k -->
    <div *ngIf="productForm.get('name')?.touched && productForm.get('name')?.invalid" class="invalid-feedback d-block">
      <div *ngIf="productForm.get('name')?.errors?.['required']">Term√©k megad√°sa sz√ºks√©ges.</div>
      <div *ngIf="productForm.get('name')?.errors?.['minlength']">Product minimum 3 karakter kell legyen.</div>
      <div *ngIf="productForm.get('name')?.errors?.['maxlength']">Product maximum 50 karakter lehet.</div>
      <div *ngIf="productForm.get('name')?.errors?.['pattern']">A term√©kn√©v nem √°llhat csak sz√°mokb√≥l.</div>
    </div>
  </div>

  <!-- Le√≠r√°s -->
  <div class="mb-3">
    <label for="description" class="form-label">Le√≠r√°s <span class="text-danger">*</span></label>
    <textarea
      id="description"
      formControlName="description"
      class="form-control"
      rows="3"
      placeholder="R√∂viden √≠rd le a term√©ket..."
      [ngClass]="{'is-invalid': productForm.get('description')?.invalid && productForm.get('description')?.touched}"
    ></textarea>

    <div *ngIf="productForm.get('description')?.touched && productForm.get('description')?.invalid" class="invalid-feedback d-block">
      <div *ngIf="productForm.get('description')?.errors?.['required']">A le√≠r√°s megad√°sa k√∂telez≈ë.</div>
      <div *ngIf="productForm.get('description')?.errors?.['minlength']">A le√≠r√°s legal√°bb 10 karakter hossz√∫ legyen.</div>
      <div *ngIf="productForm.get('description')?.errors?.['maxlength']">A le√≠r√°s legfeljebb 1000 karakter lehet.</div>
    </div>
  </div>

    <!-- √År -->
    <div class="mb-3">
      <label for="productPrice" class="form-label">
        √År <span class="text-danger">*</span>
      </label>

      <div class="input-group w-100">
        <input
          type="number"
          formControlName="price"
          id="productPrice"
          class="form-control"
          placeholder="Add meg az √°rat"
          [readonly]="freePriceChecked"
          [ngClass]="{
            'is-invalid':
              productForm.get('price')?.invalid &&
              productForm.get('price')?.touched
          }"
        />
        <span class="input-group-text">Ft</span>
      </div>

      <div
        *ngIf="
          productForm.get('price')?.touched &&
          productForm.get('price')?.invalid
        "
        class="invalid-feedback d-block"
      >
        <div *ngIf="productForm.get('price')?.errors?.['required']">
          Az √°r megad√°sa k√∂telez≈ë.
        </div>
        <div *ngIf="productForm.get('price')?.errors?.['pattern']">
          Az √°r csak sz√°m lehet.
        </div>
        <div *ngIf="productForm.get('price')?.errors?.['max']">
          Az √°r nem lehet nagyobb, mint 99 999 999.
        </div>
      </div>

      <!-- ‚úÖ Checkbox -->
      <div class="form-check mt-2">
        <input
          class="form-check-input"
          type="checkbox"
          id="freePrice"
          (change)="onFreePriceChange($event)"
          [checked]="freePriceChecked"
        />
        <label class="form-check-label" for="freePrice">
          Ingyenes term√©k
        </label>
      </div>
    </div>


  <!-- √Ållapot -->
  <div class="mb-3">
    <label for="condition" class="form-label">√Ållapot <span class="text-danger">*</span></label>
    <select
      id="condition"
      formControlName="condition"
      class="form-select"
      [ngClass]="{'is-invalid': productForm.get('condition')?.invalid && productForm.get('condition')?.touched}"
    >
      <option value="" disabled selected hidden>V√°lassz √°llapotot</option>
      <option value="√öj">√öj</option>
      <option value="√öjszer≈±">√öjszer≈±</option>
      <option value="J√≥ √°llapot√∫">J√≥ √°llapot√∫</option>
      <option value="Haszn√°lt">Haszn√°lt</option>
    </select>

    <div *ngIf="productForm.get('condition')?.touched && productForm.get('condition')?.invalid" class="invalid-feedback d-block">
      √Ållapot kiv√°laszt√°sa k√∂telez≈ë.
    </div>
  </div>

  <!-- Ir√°ny√≠t√≥sz√°m -->
  <div class="mb-3">
    <label for="postal_code" class="form-label">Ir√°ny√≠t√≥sz√°m <span class="text-danger">*</span></label>
    <input
      type="text"
      id="postal_code"
      maxlength="4"
      formControlName="postal_code"
      class="form-control"
      placeholder="Pl.: 1095"
      (input)="getCityByZip()"
      [ngClass]="{'is-invalid': productForm.get('postal_code')?.invalid && productForm.get('postal_code')?.touched}"
    />

    <div *ngIf="productForm.get('postal_code')?.touched && productForm.get('postal_code')?.invalid" class="invalid-feedback d-block">
      <div *ngIf="productForm.get('postal_code')?.errors?.['required']">Az ir√°ny√≠t√≥sz√°m megad√°sa k√∂telez≈ë.</div>
      <div *ngIf="productForm.get('postal_code')?.errors?.['pattern']">Az ir√°ny√≠t√≥sz√°m pontosan 4 sz√°mjegyb≈ël √°llhat.</div>
    </div>
  </div>

  <!-- V√°ros -->
  <div class="mb-3">
    <label for="city" class="form-label">V√°ros <span class="text-danger">*</span></label>
    <input
      type="text"
      id="city"
      formControlName="city"
      class="form-control"
      placeholder="Automatikusan kit√∂ltve"
      [readonly]="isCityReadonly"
      [ngClass]="{'is-invalid': productForm.get('city')?.invalid && productForm.get('city')?.touched}"
    />

    <div *ngIf="productForm.get('city')?.touched && productForm.get('city')?.invalid" class="invalid-feedback d-block">
      <div *ngIf="productForm.get('city')?.errors?.['required']">A v√°ros megad√°sa k√∂telez≈ë.</div>
      <div *ngIf="productForm.get('city')?.errors?.['pattern']">A v√°ros neve csak bet≈±ket, sz√≥k√∂zt √©s k√∂t≈ëjelet tartalmazhat.</div>
    </div>
  </div>
        
            <!-- K√©pek el≈ën√©zete -->
            @if (images.length > 0) {
            <div class="mb-3">
                <label class="form-label">K√©pek</label>
                <div class="d-flex flex-wrap gap-2">
                @for (img of images; track $index) {
                    <img
                    [src]="img"
                    alt="Term√©kk√©p"
                    class="rounded border"
                    style="width: 120px; height: 120px; object-fit: cover;"
                    />
                }
                </div>
            </div>
            }

        <!-- K√©pek szerkeszt√©se gomb -->
        <div class="mb-3">
        <button type="button" class="btn btn-secondary" (click)="goToModifyImages()">
            K√©pek m√≥dos√≠t√°sa
        </button>
        </div>

        <div *ngIf="successMessage" class="alert alert-success mt-3" role="alert">
          {{ successMessage }}
        </div>

        <div *ngIf="errorMessage" class="alert alert-danger mt-3" role="alert">
          {{ errorMessage }}
        </div>



    <!-- Ment√©s gomb -->
    <button
      type="submit"
      class="btn btn-primary w-100 mt-3"
      [disabled]="productForm.invalid"
    >
      Ment√©s
    </button>
  </form>
</div>
